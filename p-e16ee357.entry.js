import{r as t,c as i,h as s,d as n}from"./p-e3de215b.js";const h=class{constructor(s){t(this,s),this.fireenjinFetch=i(this,"fireenjinFetch",7),this.fireenjinReset=i(this,"fireenjinReset",7),this.fireenjinSubmit=i(this,"fireenjinSubmit",7),this.fireenjinValidation=i(this,"fireenjinValidation",7),this.componentIsLoaded=!1,this.formData={},this.submitButton="Save",this.submitButtonColor="primary",this.submitButtonFill="solid",this.resetButton="Cancel",this.resetButtonColor="dark",this.resetButtonFill="clear",this.hideControls=!1,this.excludeData=[],this.disableLoader=!1,this.loading=!1,this.disableEnterButton=!1,this.disableReset=!1,this.confirmExit=!1,this.hasChanged=!1}onInput(t){t&&t.target&&t.target.name&&!t.target.name.startsWith("ion-")&&0===(this.excludeData?this.excludeData:[]).filter((i=>i===t.target.name)).length&&(this.setByPath(this.formData,t.target.name,t.target.value),this.componentIsLoaded&&!this.hasChanged&&(this.hasChanged=!0))}onSelect(t){t&&t.target&&t.target.name&&0===(this.excludeData?this.excludeData:[]).filter((i=>i===t.target.name)).length&&(this.formData[t.target.name]=t.target.value,this.componentIsLoaded&&!this.hasChanged&&(this.hasChanged=!0))}async onKeyDown(t){"Enter"===t.key&&await this.checkFormValidity()&&this.submitButtonEl&&!this.disableEnterButton&&this.submitButtonEl.click()}async onSuccess(t){var i;t.detail.target===this.fireenjinFormEl&&(this.formData=await this.mapFormData(this.findDataMap,(null===(i=t.detail)||void 0===i?void 0:i.data)?t.detail.data:{}),await this.setFormData(this.formData))}async setLoading(t){this.loading=!!t}async submit(t){t.preventDefault(),await this.checkFormValidity(),this.loading=!this.disableLoader;const i=this.beforeSubmit&&"function"==typeof this.beforeSubmit?await this.beforeSubmit(this.formData):this.formData;this.fireenjinSubmit.emit({event:t,id:this.documentId,endpoint:this.endpoint,data:i,name:this.name}),this.hasChanged=!1}async reset(t){if(!t)return this.formEl.reset(),!1;this.formData={},this.fireenjinReset.emit({event:t,id:this.documentId,endpoint:this.endpoint,data:this.formData,name:this.name}),this.hasChanged=!1}async checkFormValidity(t=!0){let i=!0;const s=[].slice.call(this.formEl.querySelectorAll("fireenjin-input"));for(const n of s)await n.checkValidity(t?null:{validationClassOptions:{ignoreInvalid:!0}})||(i&&t&&await n.reportValidity(),i=!1);return i}async reportFormValidity(){const t=await this.checkFormValidity(!1);this.fireenjinValidation.emit({event,isValid:t,name:this.name}),this.submitButtonEl&&(this.submitButtonEl.disabled=!t)}async setFormData(t){this.formEl.querySelectorAll("[data-fill]").forEach((i=>{var s,n;const h=(null===(n=null===(s=i.dataset)||void 0===s?void 0:s.fill)||void 0===n?void 0:n.length)>0?i.dataset.fill:i.name;i.value=this.getByPath(t,h)})),this.formData=t}async mapFormData(t,i){let s=i||{};if(t){const n=Object.keys(t);for(const h of n)t[h]?s[t[h]]=i[h]:s=Object.assign(Object.assign({},s),i[h])}return s}getByPath(t,i){for(var s=(i=(i=i.replace(/\[(\w+)\]/g,".$1")).replace(/^\./,"")).split("."),n=0,h=s.length;n<h;++n){var e=s[n];if(!(e in t))return;t=t[e]}return t}setByPath(t,i,s){const n=i.split("."),h=n.length;for(let i=0;i<h-1;i++){const s=n[i];t[s]||(t[s]={}),t=t[s]}t[n[h-1]]=s}componentDidLoad(){setTimeout((()=>{this.componentIsLoaded=!0}),2e3),this.findEndpoint&&this.documentId&&this.fireenjinFetch.emit({endpoint:this.findEndpoint,params:Object.assign(Object.assign({},this.findParams?this.findParams:{}),{id:this.documentId})}),this.formData&&this.setFormData(this.formData)}render(){return s("form",{ref:t=>this.formEl=t,name:this.name,id:this.name,onReset:t=>this.reset(t),onSubmit:t=>this.submit(t),class:{"is-loading":this.loading}},s("slot",null),!this.hideControls&&s("ion-grid",{class:"form-controls"},s("ion-row",null,s("ion-col",null,this.resetButton?s("ion-button",{ref:t=>this.resetButtonEl=t,type:"reset",fill:this.resetButtonFill,color:this.resetButtonColor,innerHTML:this.resetButton}):null),s("ion-col",null,this.submitButton?s("ion-button",{ref:t=>this.submitButtonEl=t,type:"submit",color:this.submitButtonColor,fill:this.submitButtonFill,innerHTML:this.submitButton}):null))))}get fireenjinFormEl(){return n(this)}};h.style="fireenjin-form{display:block}fireenjin-form .form-controls{opacity:1;pointer-events:all;transition:all ease-out 0.4s}fireenjin-form .form-controls ion-col:last-of-type{display:flex;flex-direction:row;justify-content:flex-end}fireenjin-form .is-hidden{opacity:0;pointer-events:none;height:0px}";export{h as fireenjin_form}