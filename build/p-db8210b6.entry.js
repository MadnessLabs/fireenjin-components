import{r as t,c as i,h as s}from"./p-722f2f18.js";import{c as e,g as n}from"./p-eab67c09.js";var l=e((function(t,i){function s(t){var i=arguments.length<=1||void 0===arguments[1]?500:arguments[1],s=void 0;function e(){for(var n=this,l=arguments.length,o=Array(l),h=0;h<l;h++)o[h]=arguments[h];e.clear(),s=setTimeout((function(){s=null,t.apply(n,o)}),i)}return e.clear=function(){s&&(clearTimeout(s),s=null)},e}Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(t){return function(i,e,n){return{configurable:!0,enumerable:n.enumerable,get:function(){return Object.defineProperty(this,e,{configurable:!0,enumerable:n.enumerable,value:s(n.value,t)}),this[e]}}}},i.debounce=s,i.DEFAULT_DEBOUNCE_DURATION=500}));const o=n(e((function(t,i){function s(t,i){for(var s=Object.getOwnPropertyNames(i),e=0;e<s.length;e++){var n=s[e],l=Object.getOwnPropertyDescriptor(i,n);l&&l.configurable&&void 0===t[n]&&Object.defineProperty(t,n,l)}return t}Object.defineProperty(i,"__esModule",{value:!0});var e,n,o=(e=l)&&e.__esModule?e:{default:e};i.default=o.default,s(i,(delete(n=s({},l)).default,n))})));const h=class{constructor(s){t(this,s),this.fireenjinFetch=i(this,"fireenjinFetch",7),this.disableFetch=!1,this.display="grid",this.page=0,this.results=[],this.loadingSpinner="bubbles",this.loadingText="Loading more data...",this.name="pagination",this.paramData={}}onQuery(){this.results=[],this.getResults({page:0})}onOrderBy(){this.results=[],this.getResults({page:0})}onDisplay(){setTimeout((async()=>{window.dispatchEvent(new window.Event("resize"))}),2e3)}async onSuccess(t){if(console.log(t.detail),t.detail.name===this.name){let i=[];try{i=this.resultsKey.split(".").reduce(((t,i)=>t[i]),t.detail.data)}catch(i){console.log("Error getting results",t.detail,this.resultsKey)}try{0===this.page&&(this.results=[]),this.page=this.pageKey?this.pageKey.split(".").reduce(((t,i)=>t[i]),t.detail.data):this.page+1,await this.addResults(i)}catch(t){console.log("Error updating results!")}await this.infiniteScrollEl.complete(),await this.virtualScrollEl.checkEnd(),(!(null==i?void 0:i.length)||this.pageCountKey&&this.pageKey&&this.pageKey.split(".").reduce(((t,i)=>t[i]),t.detail.data)===this.pageCountKey.split(".").reduce(((t,i)=>t[i]),t.detail.data))&&(this.infiniteScrollEl.disabled=!0),setTimeout((()=>{window.dispatchEvent(new window.Event("resize"))}),200)}}onInfiniteScroll(){this.getResults({next:!0})}onResize(){var t,i;if("list"===this.display&&(null===(t=this.virtualScrollEl)||void 0===t?void 0:t.querySelector("ion-item")))this.approxItemHeight=this.virtualScrollEl.querySelector("ion-item").offsetHeight;else if("grid"===this.display&&(null===(i=this.virtualScrollEl)||void 0===i?void 0:i.querySelectorAll("ion-col"))){let t,i;const s=this.virtualScrollEl.querySelectorAll("ion-col");for(t=0;t<s.length;t++){const e=s[t];if(i&&e.offsetTop!==i.offsetTop)break;i=e}i&&i.firstChild&&(this.approxItemHeight=i.firstChild.scrollHeight/t+18)}}async clearParamData(t){if(t&&this.paramData[t]){const i=this.paramData;delete i[t],this.paramData=i}else t||(this.paramData={});return this.paramData}async addResults(t=[]){this.results=[...this.results,...t]}async clearResults(){this.page=0,this.results=[]}async getResults(t={}){var i,s;(t.page||0===t.page)&&(this.page=t.page),t.next&&(this.page=this.page+1),this.paramData=Object.assign(Object.assign(Object.assign({},this.paramData),{limit:t.limit?t.limit:this.limit,orderBy:this.orderBy,orderDirection:this.orderDirection,page:this.page}),(null==t?void 0:t.paramData)?t.paramData:{}),(this.query||""===this.query)&&(this.paramData.query=this.query),t.next&&(null===(i=this.results)||void 0===i?void 0:i.length)&&(null===(s=this.results[this.results.length-1])||void 0===s?void 0:s.id)&&(this.paramData.next=this.results[this.results.length-1].id),this.fireenjinFetch.emit({name:this.name,endpoint:this.endpoint,dataPropsMap:this.dataPropsMap?this.dataPropsMap:null,disableFetch:this.disableFetch,params:{data:this.fetchData?this.fetchData:this.paramData}})}componentWillLoad(){this.collection&&(this.resultsKey=this.resultsKey?this.resultsKey:`${this.collection}.results`,this.pageKey=this.pageKey?this.pageKey:`${this.collection}.page`,this.pageCountKey=this.pageCountKey?this.pageCountKey:`${this.collection}.pageCount`,this.resultCountKey=this.resultCountKey?this.resultCountKey:`${this.collection}.resultCount`,this.name=this.name?this.name:`${this.collection}Pagination`),this.getResults()}componentDidLoad(){window.dispatchEvent(new window.Event("resize")),this.resizeInterval=setInterval((()=>{window.dispatchEvent(new window.Event("resize"))}),3e3)}disconnectedCallback(){clearInterval(this.resizeInterval)}render(){return s("div",{class:"pagination"},s("ion-virtual-scroll",{ref:t=>this.virtualScrollEl=t,items:this.results,approxItemHeight:this.approxItemHeight},"grid"===this.display?s("ion-grid",null,s("ion-row",null,this.results.map((t=>"string"==typeof this.gridEl({result:t},null,null)?s("ion-col",{innerHTML:this.gridEl({result:t},null,null)}):s("ion-col",null,this.gridEl({result:t},null,null)))))):s("ion-card",null,s("ion-list",null,this.results.map((t=>"string"==typeof this.listEl({result:t},null,null)?s("div",{innerHTML:this.listEl({result:t},null,null)}):this.listEl({result:t},null,null)))))),s("ion-infinite-scroll",{style:{display:"block"},ref:t=>this.infiniteScrollEl=t},s("ion-infinite-scroll-content",{"loading-spinner":this.loadingSpinner,"loading-text":this.loadingText})))}static get watchers(){return{query:["onQuery"],orderBy:["onOrderBy"],display:["onDisplay"]}}};(function(t,i,s,e){var n,l=arguments.length,o=l<3?i:null===e?e=Object.getOwnPropertyDescriptor(i,s):e;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,i,s,e);else for(var h=t.length-1;h>=0;h--)(n=t[h])&&(o=(l<3?n(o):l>3?n(i,s,o):n(i,s))||o);l>3&&o&&Object.defineProperty(i,s,o)})([o(1e3)],h.prototype,"onQuery",null),h.style="";export{h as fireenjin_pagination}