import{r as i,c as t,w as n,a as s,h as e,d as o,H as r,f as l}from"./p-722f2f18.js";import{g as h,c as a}from"./p-46b0784d.js";import{s as c}from"./p-111520a0.js";const d=class{constructor(n){i(this,n),this.ionInfinite=t(this,"ionInfinite",7),this.thrPx=0,this.thrPc=0,this.didFire=!1,this.isBusy=!1,this.isLoading=!1,this.threshold="15%",this.disabled=!1,this.position="bottom",this.onScroll=()=>{const i=this.scrollEl;if(!i||!this.canStart())return 1;const t=this.el.offsetHeight;if(0===t)return 2;const n=i.scrollTop,s=i.offsetHeight,e=0!==this.thrPc?s*this.thrPc:this.thrPx;if(("bottom"===this.position?i.scrollHeight-t-n-e-s:n-t-e)<0){if(!this.didFire)return this.isLoading=!0,this.didFire=!0,this.ionInfinite.emit(),3}else this.didFire=!1;return 4}}thresholdChanged(){const i=this.threshold;i.lastIndexOf("%")>-1?(this.thrPx=0,this.thrPc=parseFloat(i)/100):(this.thrPx=parseFloat(i),this.thrPc=0)}disabledChanged(){const i=this.disabled;i&&(this.isLoading=!1,this.isBusy=!1),this.enableScrollEvents(!i)}async connectedCallback(){const i=this.el.closest("ion-content");i?(this.scrollEl=await i.getScrollElement(),this.thresholdChanged(),this.disabledChanged(),"top"===this.position&&n((()=>{this.scrollEl&&(this.scrollEl.scrollTop=this.scrollEl.scrollHeight-this.scrollEl.clientHeight)}))):console.error("<ion-infinite-scroll> must be used inside an <ion-content>")}disconnectedCallback(){this.enableScrollEvents(!1),this.scrollEl=void 0}async complete(){const i=this.scrollEl;if(this.isLoading&&i&&(this.isLoading=!1,"top"===this.position)){this.isBusy=!0;const t=i.scrollHeight-i.scrollTop;requestAnimationFrame((()=>{s((()=>{const s=i.scrollHeight-t;requestAnimationFrame((()=>{n((()=>{i.scrollTop=s,this.isBusy=!1}))}))}))}))}}canStart(){return!(this.disabled||this.isBusy||!this.scrollEl||this.isLoading)}enableScrollEvents(i){this.scrollEl&&(i?this.scrollEl.addEventListener("scroll",this.onScroll):this.scrollEl.removeEventListener("scroll",this.onScroll))}render(){const i=h(this);return e(r,{class:{[i]:!0,"infinite-scroll-loading":this.isLoading,"infinite-scroll-enabled":!this.disabled}})}get el(){return o(this)}static get watchers(){return{threshold:["thresholdChanged"],disabled:["disabledChanged"]}}};d.style="ion-infinite-scroll{display:none;width:100%}.infinite-scroll-enabled{display:block}";const f=class{constructor(t){i(this,t)}componentDidLoad(){if(void 0===this.loadingSpinner){const i=h(this);this.loadingSpinner=a.get("infiniteLoadingSpinner",a.get("spinner","ios"===i?"lines":"crescent"))}}render(){const i=h(this);return e(r,{class:{[i]:!0,[`infinite-scroll-content-${i}`]:!0}},e("div",{class:"infinite-loading"},this.loadingSpinner&&e("div",{class:"infinite-loading-spinner"},e("ion-spinner",{name:this.loadingSpinner})),this.loadingText&&e("div",{class:"infinite-loading-text",innerHTML:c(this.loadingText)})))}};f.style={ios:"ion-infinite-scroll-content{display:flex;flex-direction:column;justify-content:center;min-height:84px;text-align:center;user-select:none}.infinite-loading{margin-left:0;margin-right:0;margin-top:0;margin-bottom:32px;display:none;width:100%}.infinite-loading-text{margin-left:32px;margin-right:32px;margin-top:4px;margin-bottom:0}@supports (margin-inline-start: 0) or (-webkit-margin-start: 0){.infinite-loading-text{margin-left:unset;margin-right:unset;-webkit-margin-start:32px;margin-inline-start:32px;-webkit-margin-end:32px;margin-inline-end:32px}}.infinite-scroll-loading ion-infinite-scroll-content>.infinite-loading{display:block}.infinite-scroll-content-ios .infinite-loading-text{color:var(--ion-color-step-600, #666666)}.infinite-scroll-content-ios .infinite-loading-spinner .spinner-lines-ios line,.infinite-scroll-content-ios .infinite-loading-spinner .spinner-lines-small-ios line,.infinite-scroll-content-ios .infinite-loading-spinner .spinner-crescent circle{stroke:var(--ion-color-step-600, #666666)}.infinite-scroll-content-ios .infinite-loading-spinner .spinner-bubbles circle,.infinite-scroll-content-ios .infinite-loading-spinner .spinner-circles circle,.infinite-scroll-content-ios .infinite-loading-spinner .spinner-dots circle{fill:var(--ion-color-step-600, #666666)}",md:"ion-infinite-scroll-content{display:flex;flex-direction:column;justify-content:center;min-height:84px;text-align:center;user-select:none}.infinite-loading{margin-left:0;margin-right:0;margin-top:0;margin-bottom:32px;display:none;width:100%}.infinite-loading-text{margin-left:32px;margin-right:32px;margin-top:4px;margin-bottom:0}@supports (margin-inline-start: 0) or (-webkit-margin-start: 0){.infinite-loading-text{margin-left:unset;margin-right:unset;-webkit-margin-start:32px;margin-inline-start:32px;-webkit-margin-end:32px;margin-inline-end:32px}}.infinite-scroll-loading ion-infinite-scroll-content>.infinite-loading{display:block}.infinite-scroll-content-md .infinite-loading-text{color:var(--ion-color-step-600, #666666)}.infinite-scroll-content-md .infinite-loading-spinner .spinner-lines-md line,.infinite-scroll-content-md .infinite-loading-spinner .spinner-lines-small-md line,.infinite-scroll-content-md .infinite-loading-spinner .spinner-crescent circle{stroke:var(--ion-color-step-600, #666666)}.infinite-scroll-content-md .infinite-loading-spinner .spinner-bubbles circle,.infinite-scroll-content-md .infinite-loading-spinner .spinner-circles circle,.infinite-scroll-content-md .infinite-loading-spinner .spinner-dots circle{fill:var(--ion-color-step-600, #666666)}"};const p=(i,t)=>{const n=g(i,t);return n&&i.ownerDocument?i.ownerDocument.importNode(n.content,!0).children[0]:null},g=(i,t)=>{switch(t){case"item":return i.querySelector("template:not([name])");case"header":return i.querySelector("template[name=header]");case"footer":return i.querySelector("template[name=footer]")}},m=(i,t,n,s,e,o,r,l,h,a,c,d)=>{const f=[],p=d+c;for(let d=c;d<p;d++){const c=i[d];if(e){const t=e(c,d,i);null!=t&&f.push({i:a++,type:"header",value:t,index:d,height:n?n(t,d):r,reads:n?0:2,visible:!!n})}if(f.push({i:a++,type:"item",value:c,index:d,height:t?t(c,d):h,reads:t?0:2,visible:!!t}),o){const t=o(c,d,i);null!=t&&f.push({i:a++,type:"footer",value:t,index:d,height:s?s(t,d):l,reads:s?0:2,visible:!!s})}}return f},u=class{constructor(t){i(this,t),this.range={offset:0,length:0},this.viewportHeight=0,this.cells=[],this.virtualDom=[],this.isEnabled=!1,this.viewportOffset=0,this.currentScrollTop=0,this.indexDirty=0,this.lastItemLen=0,this.totalHeight=0,this.approxItemHeight=45,this.approxHeaderHeight=30,this.approxFooterHeight=30,this.onScroll=()=>{this.updateVirtualScroll()}}itemsChanged(){this.calcCells(),this.updateVirtualScroll()}async connectedCallback(){const i=this.el.closest("ion-content");i?(this.scrollEl=await i.getScrollElement(),this.contentEl=i,this.calcCells(),this.updateState()):console.error("<ion-virtual-scroll> must be used inside an <ion-content>")}componentDidUpdate(){this.updateState()}disconnectedCallback(){this.scrollEl=void 0}onResize(){this.calcCells(),this.updateVirtualScroll()}positionForItem(i){return Promise.resolve(((i,t,n)=>{const s=t.find((t=>"item"===t.type&&t.index===i));return s?n[s.i]:-1})(i,this.cells,this.getHeightIndex()))}async checkRange(i,t=-1){if(!this.items)return;const n=-1===t?this.items.length-i:t,s=((i,t)=>0===t?0:t===(i.length>0?i[i.length-1].index:0)+1?i.length:i.findIndex((i=>i.index===t)))(this.cells,i),e=m(this.items,this.itemHeight,this.headerHeight,this.footerHeight,this.headerFn,this.footerFn,this.approxHeaderHeight,this.approxFooterHeight,this.approxItemHeight,s,i,n);this.cells=((i,t,n)=>{if(0===n&&t.length>=i.length)return t;for(let s=0;s<t.length;s++)i[s+n]=t[s];return i})(this.cells,e,s),this.lastItemLen=this.items.length,this.indexDirty=Math.max(i-1,0),this.scheduleUpdate()}async checkEnd(){this.items&&this.checkRange(this.lastItemLen)}updateVirtualScroll(){this.isEnabled&&this.scrollEl&&(this.timerUpdate&&(clearTimeout(this.timerUpdate),this.timerUpdate=void 0),s(this.readVS.bind(this)),n(this.writeVS.bind(this)))}readVS(){const{contentEl:i,scrollEl:t,el:n}=this;let s=0,e=n;for(;e&&e!==i;)s+=e.offsetTop,e=e.offsetParent;this.viewportOffset=s,t&&(this.viewportHeight=t.offsetHeight,this.currentScrollTop=t.scrollTop)}writeVS(){const i=this.indexDirty,t=(e=this.currentScrollTop-this.viewportOffset,o=this.viewportHeight,{top:Math.max(e-100,0),bottom:e+o+100}),n=this.getHeightIndex(),s=((i,t)=>{const n=t.top,s=t.bottom;let e=0;for(;e<i.length&&!(i[e]>n);e++);const o=Math.max(e-2-1,0);for(;e<i.length&&!(i[e]>=s);e++);return{offset:o,length:Math.min(e+2,i.length)-o}})(n,t);var e,o;((i,t,n)=>i<=n.offset+n.length||t.offset!==n.offset||t.length!==n.length)(i,this.range,s)&&(this.range=s,((i,t,n,s)=>{for(const t of i)t.change=0,t.d=!0;const e=[],o=s.offset+s.length;for(let r=s.offset;r<o;r++){const s=n[r],o=i.find((i=>i.d&&i.cell===s));if(o){const i=t[r];i!==o.top&&(o.top=i,o.change=1),o.d=!1}else e.push(s)}const r=i.filter((i=>i.d));for(const n of e){const s=r.find((i=>i.d&&i.cell.type===n.type)),e=n.i;s?(s.d=!1,s.change=2,s.cell=n,s.top=t[e]):i.push({d:!1,cell:n,visible:!0,change:2,top:t[e]})}i.filter((i=>i.d&&-9999!==i.top)).forEach((i=>{i.change=1,i.top=-9999}))})(this.virtualDom,n,this.cells,s),this.nodeRender?((i,t,n,s)=>{const e=Array.from(i.children).filter((i=>"TEMPLATE"!==i.tagName)),o=e.length;let r;for(let l=0;l<n.length;l++){const h=n[l],a=h.cell;if(2===h.change){if(l<o)r=e[l],t(r,a,l);else{const n=p(i,a.type);r=t(n,a,l)||n,r.classList.add("virtual-item"),i.appendChild(r)}r.$ionCell=a}else r=e[l];0!==h.change&&(r.style.transform=`translate3d(0,${h.top}px,0)`);const c=a.visible;h.visible!==c&&(c?r.classList.remove("virtual-loading"):r.classList.add("virtual-loading"),h.visible=c),a.reads>0&&(s(a,r),a.reads--)}})(this.el,this.nodeRender,this.virtualDom,this.updateCellHeight.bind(this)):this.domRender?this.domRender(this.virtualDom):this.renderItem&&l(this))}updateCellHeight(i,t){const n=()=>{if(t.$ionCell===i){const n=window.getComputedStyle(t),s=t.offsetHeight+parseFloat(n.getPropertyValue("margin-bottom"));this.setCellHeight(i,s)}};t&&t.componentOnReady?t.componentOnReady().then(n):n()}setCellHeight(i,t){const n=i.i;i===this.cells[n]&&(i.height===t&&!0===i.visible||(i.visible=!0,i.height=t,this.indexDirty=Math.min(this.indexDirty,n),this.scheduleUpdate()))}scheduleUpdate(){clearTimeout(this.timerUpdate),this.timerUpdate=setTimeout((()=>this.updateVirtualScroll()),100)}updateState(){const i=!(!this.scrollEl||!this.cells);i!==this.isEnabled&&(this.enableScrollEvents(i),i&&this.updateVirtualScroll())}calcCells(){this.items&&(this.lastItemLen=this.items.length,this.cells=m(this.items,this.itemHeight,this.headerHeight,this.footerHeight,this.headerFn,this.footerFn,this.approxHeaderHeight,this.approxFooterHeight,this.approxItemHeight,0,0,this.lastItemLen),this.indexDirty=0)}getHeightIndex(){return this.indexDirty!==1/0&&this.calcHeightIndex(this.indexDirty),this.heightIndex}calcHeightIndex(i=0){this.heightIndex=((i,t)=>{if(!i)return new Uint32Array(t);if(i.length===t)return i;if(t>i.length){const n=new Uint32Array(t);return n.set(i),n}return i.subarray(0,t)})(this.heightIndex,this.cells.length),this.totalHeight=((i,t,n)=>{let s=i[n];for(let e=n;e<i.length;e++)i[e]=s,s+=t[e].height;return s})(this.heightIndex,this.cells,i),this.indexDirty=1/0}enableScrollEvents(i){this.rmEvent&&(this.rmEvent(),this.rmEvent=void 0);const t=this.scrollEl;t&&(this.isEnabled=i,t.addEventListener("scroll",this.onScroll),this.rmEvent=()=>{t.removeEventListener("scroll",this.onScroll)})}renderVirtualNode(i){const{type:t,value:n,index:s}=i.cell;switch(t){case"item":return this.renderItem(n,s);case"header":return this.renderHeader(n,s);case"footer":return this.renderFooter(n,s)}}render(){return e(r,{style:{height:`${this.totalHeight}px`}},this.renderItem&&e(b,{dom:this.virtualDom},this.virtualDom.map((i=>this.renderVirtualNode(i)))))}get el(){return o(this)}static get watchers(){return{itemHeight:["itemsChanged"],headerHeight:["itemsChanged"],footerHeight:["itemsChanged"],items:["itemsChanged"]}}},b=({dom:i},t,n)=>n.map(t,((t,n)=>{const s=i[n],e=t.vattrs||{};let o=e.class||"";return o+="virtual-item ",s.visible||(o+="virtual-loading"),Object.assign(Object.assign({},t),{vattrs:Object.assign(Object.assign({},e),{class:o,style:Object.assign(Object.assign({},e.style),{transform:`translate3d(0,${s.top}px,0)`})})})}));u.style="ion-virtual-scroll{display:block;position:relative;width:100%;contain:strict;user-select:none}ion-virtual-scroll>.virtual-loading{opacity:0}ion-virtual-scroll>.virtual-item{position:absolute !important;top:0 !important;right:0 !important;left:0 !important;transition-duration:0ms;will-change:transform}";export{d as ion_infinite_scroll,f as ion_infinite_scroll_content,u as ion_virtual_scroll}