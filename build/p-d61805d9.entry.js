import{r as t,c as i,h as o}from"./p-f1147c95.js";async function a(t,i,o=500){return new Promise((async(n,e)=>{i&&"function"==typeof i||e("Callback function is required!");try{n(i())}catch(n){t>1?(await(s=o,new Promise((t=>setTimeout(t,s)))),a(t-1,i,2*o)):e(n)}var s}))}const n=class{constructor(o){t(this,o),this.fireenjinFetch=i(this,"fireenjinFetch",7),this.data={},this.template={},this.html=""}componentWillLoad(){var t;(null===(t=window)||void 0===t?void 0:t.Handlebars)||async function(){new Promise(((t,i)=>{const o=document.createElement("script");o.async=!0,o.src="https://cdn.jsdelivr.net/npm/handlebars@latest/dist/handlebars.js",o.addEventListener("load",t),o.addEventListener("error",(()=>i("Error loading script."))),o.addEventListener("abort",(()=>i("Script loading aborted."))),document.head.appendChild(o)}))}(),this.templateId&&this.fireenjinFetch.emit({endpoint:"findTemplate",params:{id:this.templateId}})}componentDidLoad(){a(10,this.renderTemplate.bind(this)),this.partials&&this.setPartials(this.partials)}async setPartials(t){const i=(null===localStorage||void 0===localStorage?void 0:localStorage.getItem)?JSON.parse(localStorage.getItem("enjin-editor-partials")):null;this.partials=t||i||[];for(const t of this.partials)t.html&&window.Handlebars.registerPartial(t.id,t.html);(null===localStorage||void 0===localStorage?void 0:localStorage.setItem)&&localStorage.setItem("enjin-editor-partials",JSON.stringify(this.partials))}async renderTemplate(){var t,i;this.html=window.Handlebars.compile((null===(t=this.template)||void 0===t?void 0:t.html)?null===(i=this.template)||void 0===i?void 0:i.html:"")(this.data?this.data:{})}onSuccess(t){var i,o,a;"findTemplate"===(null===(i=null==t?void 0:t.detail)||void 0===i?void 0:i.endpoint)&&(this.template=(null===(a=null===(o=null==t?void 0:t.detail)||void 0===o?void 0:o.data)||void 0===a?void 0:a.template)?t.detail.data.template:null)}onTemplateId(){this.fireenjinFetch.emit({endpoint:"findTemplate",params:{id:this.templateId}})}onData(){a(10,this.renderTemplate.bind(this))}onTemplate(){a(10,this.renderTemplate.bind(this))}onPartials(){this.setPartials(this.partials)}render(){return o("div",{innerHTML:this.html})}static get watchers(){return{templateId:["onTemplateId"],data:["onData"],template:["onTemplate"],partials:["onPartials"]}}};export{n as fireenjin_render_template}