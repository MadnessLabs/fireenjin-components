import{r as i,c as t,h as n}from"./p-e3de215b.js";function e(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}function s(i,t,n){return i(n={path:t,exports:{},require:function(){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}()}},n.exports),n.exports}var o=s((function(i,t){function n(i){var t=arguments.length<=1||void 0===arguments[1]?500:arguments[1],n=void 0;function e(){for(var s=this,o=arguments.length,r=Array(o),l=0;l<o;l++)r[l]=arguments[l];e.clear(),n=setTimeout((function(){n=null,i.apply(s,r)}),t)}return e.clear=function(){n&&(clearTimeout(n),n=null)},e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(i){return function(t,e,s){return{configurable:!0,enumerable:s.enumerable,get:function(){return Object.defineProperty(this,e,{configurable:!0,enumerable:s.enumerable,value:n(s.value,i)}),this[e]}}}},t.debounce=n,t.DEFAULT_DEBOUNCE_DURATION=500}));const r=e(s((function(i,t){function n(i,t){for(var n=Object.getOwnPropertyNames(t),e=0;e<n.length;e++){var s=n[e],o=Object.getOwnPropertyDescriptor(t,s);o&&o.configurable&&void 0===i[s]&&Object.defineProperty(i,s,o)}return i}Object.defineProperty(t,"__esModule",{value:!0});var e,s,r=(e=o)&&e.__esModule?e:{default:e};t.default=r.default,n(t,(delete(s=n({},o)).default,s))})));const l=class{constructor(n){i(this,n),this.fireenjinFetch=t(this,"fireenjinFetch",7),this.disableFetch=!1,this.display="grid",this.page=0,this.results=[],this.loadingSpinner="bubbles",this.loadingText="Loading more data...",this.paramData={}}onQuery(){this.results=[],this.getResults({page:0})}onOrderBy(){this.results=[],this.getResults({page:0})}onDisplay(){setTimeout((async()=>{window.dispatchEvent(new window.Event("resize"))}),2e3)}async onSuccess(i){var t,n,e,s,o,r;if("pagination"===i.detail.name){try{0===this.page&&(this.results=[]),this.page=(null===(e=null===(n=null===(t=i.detail)||void 0===t?void 0:t.data)||void 0===n?void 0:n.results)||void 0===e?void 0:e.page)?i.detail.data.results.page:this.page+1,await this.addResults(i.detail.data.results)}catch(i){console.log("Error updating results!")}await this.infiniteScrollEl.complete(),await this.virtualScrollEl.checkEnd(),(null===(r=null===(o=null===(s=i.detail)||void 0===s?void 0:s.data)||void 0===o?void 0:o.results)||void 0===r?void 0:r.length)||(this.infiniteScrollEl.disabled=!0),setTimeout((async()=>{window.dispatchEvent(new window.Event("resize"))}),2e3)}}onInfiniteScroll(){this.getResults({next:!0})}onResize(){if("list"===this.display&&this.virtualScrollEl.querySelector("ion-item"))this.approxItemHeight=this.virtualScrollEl.querySelector("ion-item").offsetHeight;else if("grid"===this.display&&this.virtualScrollEl.querySelectorAll("ion-col")){let i,t;const n=this.virtualScrollEl.querySelectorAll("ion-col");for(i=0;i<n.length;i++){const e=n[i];if(t&&e.offsetTop!==t.offsetTop)break;t=e}t&&t.firstChild&&(this.approxItemHeight=t.firstChild.scrollHeight/i+18)}}async clearParamData(i){if(i&&this.paramData[i]){const t=this.paramData;delete t[i],this.paramData=t}else i||(this.paramData={});return this.paramData}async addResults(i=[]){this.results=[...this.results,...i]}async clearResults(){this.page=0,this.results=[]}async getResults(i={}){var t,n,e;this.paramData=Object.assign(Object.assign(Object.assign({},this.paramData),{limit:i.limit?i.limit:this.limit,orderBy:this.orderBy,orderDirection:this.orderDirection}),(null==i?void 0:i.paramData)?i.paramData:{}),i.page&&(this.page=i.page),(null===(t=this.query)||void 0===t?void 0:t.length)>1&&(this.paramData.query=this.query),(null===(n=this.results)||void 0===n?void 0:n.length)&&(null===(e=this.results[this.results.length-1])||void 0===e?void 0:e.id)&&(this.paramData.next=this.results[this.results.length-1].id),this.fireenjinFetch.emit({name:"pagination",endpoint:this.endpoint,dataPropsMap:this.dataPropsMap,disableFetch:this.disableFetch,params:{data:this.fetchData?this.fetchData:this.paramData}})}componentDidLoad(){this.getResults()}render(){return n("div",{class:"pagination"},n("ion-virtual-scroll",{ref:i=>this.virtualScrollEl=i,items:this.results,approxItemHeight:this.approxItemHeight},"grid"===this.display?n("ion-grid",null,n("ion-row",null,this.results.map((i=>n("ion-col",null,this.gridEl({result:i},null,null)))))):n("ion-card",null,n("ion-list",null,this.results.map((i=>this.listEl({result:i},null,null)))))),n("ion-infinite-scroll",{style:{display:"block"},ref:i=>this.infiniteScrollEl=i},n("ion-infinite-scroll-content",{"loading-spinner":this.loadingSpinner,"loading-text":this.loadingText})))}static get watchers(){return{query:["onQuery"],orderBy:["onOrderBy"],display:["onDisplay"]}}};(function(i,t,n,e){var s,o=arguments.length,r=o<3?t:null===e?e=Object.getOwnPropertyDescriptor(t,n):e;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(i,t,n,e);else for(var l=i.length-1;l>=0;l--)(s=i[l])&&(r=(o<3?s(r):o>3?s(t,n,r):s(t,n))||r);o>3&&r&&Object.defineProperty(t,n,r)})([r(1e3)],l.prototype,"onQuery",null),l.style="";export{l as fireenjin_pagination}